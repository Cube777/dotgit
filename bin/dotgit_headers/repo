#! /bin/bash
# Part of dotgit

function errecho
{
	>&2 echo $@
}

function init
{
	touch $FILELIST
	touch $CRYPTLIST

	if [ ! -d ".git" ]; then
		git init
		git checkout -b master
		git add --all
		git commit -m "Initial dotgit commit"
	fi
}

function safety_checks
{
	if [[ $REPO == $HOME ]]; then
		errecho "Do not run dotgit in your home directory, run it in your" \
			"dotfiles repository"
		exit 1
	fi

	if [ ! -d ".git" ]; then
		errecho "This does not appear to be a git directory. Aborting..."
		exit 1
	fi

	if [ ! -f $FILELIST ]; then
		errecho "Cannot locate filelist. Please make sure this repository" \
			"was initialised by dotgit."
		exit 1
	fi

	if [ ! -f $CRYPTLIST ]; then
		errecho "Cannot locate cryptlist. Please make sure this repository" \
			"was initialised by dotgit."
		exit 1
	fi
}

function init_flists
{
	local n=0

	IFS=":"
	for cur in $FILELIST $CRYPTLIST; do
		while read line; do
			local l=($line)
			if [ $n -eq 0 ]; then
				N_F=(${N_F[@]} ${l[0]})
				N_C=(${N_C[@]} ${l[1]})
			else
				C_F=(${C_F[@]} ${l[0]})
				C_C=(${C_C[@]} ${l[1]})
			fi
		done < "$cur"
		n=1
	done

	unset cur
}

[ ! $DG_START ] && echo "Do not source this directly, it is used by dotgit"
