#! /bin/bash
# shellcheck disable=SC2155

# Dotgit is an easy-to-use and effective way to backup all your dotfiles and
# manage them in a repository

# Developer: Kobus van Schoor

declare -r DG_START=0 # Marker for header files
declare -r DG_H=$(dirname "$(readlink -f "$0")")/dotgit_headers # Headers DIR
declare -r REPO="$PWD" # Original repo dir
declare -r FILELIST="filelist"
declare -r CRYPTLIST="cryptlist"

# shellcheck source=dotgit_headers/help
source "$DG_H/help"
# shellcheck source=dotgit_headers/repo
source "$DG_H/repo"

declare -a CTG # Active categories

declare -a N_F # Normal files
declare -a N_C # Normal categories
declare -a C_F # Crypt files
declare -a C_C # Crypt categories

if [[ $# == 0 ]]; then
	phelp
	exit
elif [[ $# == 1 ]]; then
	CTG=(common $HOSTNAME)
else
	# shellcheck disable=SC2034
	CTG=(${@:2})
fi

[[ $1 != init ]] && safety_checks
init_flists

case "$1" in
	"help")phelp;;
	"init")init;;
	# "update")update CTG[@];;
	# "restore")restore CTG[@];;
	# "generate")generate CTG[@];;
	# "hard-restore")hardrestore CTG[@];;
	# "encrypt")encrypt;;
	# "decrypt")decrypt;;
	# "clean")cleanhome;;
	# "passwd")passwd;;
	# "diff")pdiff;;
	*)echo -e "$1 is not a valid argument."; exit 1;;
esac;
